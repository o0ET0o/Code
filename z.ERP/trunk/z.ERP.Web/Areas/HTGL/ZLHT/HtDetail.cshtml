@using z.ERP.Web.Areas.Share.Render
@using z.ERP.Entities.Enum
@using z.ERP.Web.Areas.Layout.Detail;

@inherits DetailLayout<dynamic>

@section Title{
    @Html.Raw("详情");
}

@{
    var contract = ViewBag.contract;
    //var contractBrand = ViewBag.contractBrand as DataTable;
    //var contractShop = ViewBag.contractShop as DataTable;
    //var ContractParm = ViewBag.ContractParm;
    //var ContractRentParm = ViewBag.ContractRentParm;
    //var contractPay = ViewBag.contractPay as DataTable;
    //var contractCost = ViewBag.contractCost as DataTable;
}

@section btn{
    @{
   //     if (Model != null && !Model.Permission_Exec.IsEmpty() && employee.HasPermission(Model.Permission_Exec))
        {
            if (@contract.STATUS == "1")
            {
                RenderControl(new ButtonRender()
                {
                    Text = "审核",
                    Click = "exec",
                });
            }
        }
    }
}

@section content{

    <row>
        <i-col span="2" class="RowText">租约号</i-col>
        <i-col span="4">
            <i-input v-model="CONTRACTID" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">分店名称</i-col>
        <i-col span="4">
            <i-input v-model="FDNAME" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">状态</i-col>
        <i-col span="4">
            <i-input v-model="STATUSMC" :readonly="true"></i-input>
        </i-col>


        <i-col span="2" class="RowTitle">建筑面积</i-col>
        <i-col span="4">
            <i-input v-model="AREA_BUILD" :readonly="true"></i-input>
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowText">商户代码</i-col>
        <i-col span="4">
            <i-input v-model="MERCHANTID" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">商户名称</i-col>
        <i-col span="4">
            <i-input v-model="MERNAME" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">招商部门</i-col>
        <i-col span="4">
            <i-input v-model="ORGNAME" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">租用面积</i-col>
        <i-col span="4">
            <i-input v-model="AREAR" :readonly="true"></i-input>
        </i-col>
    </row>

    <row>
        <i-col span="2" class="RowText">开始日期</i-col>
        <i-col span="4">
            <i-input v-model="CONT_START" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">结束日期</i-col>
        <i-col span="4">
            <i-input v-model="CONT_END" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">合作方式</i-col>
        <i-col span="4">
            <i-input v-model="OPERATERULENAME" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">进项税率</i-col>
        <i-col span="4">
            <i-input v-model="JXSL" :readonly="true"></i-input>
        </i-col>
    </row>


    <row>
        <i-col span="2" class="RowText">装修期起</i-col>
        <i-col span="4">
            <i-input v-model="FIT_BEGIN" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">装修期至</i-col>
        <i-col span="4">
            <i-input v-model="FIT_END" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">免租期起</i-col>
        <i-col span="4">
            <i-input v-model="FREE_BEGIN" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">免租期至</i-col>
        <i-col span="4">
            <i-input v-model="FREE_END" :readonly="true"></i-input>
        </i-col>
    </row>

    <row>
        <i-col span="2" class="RowTitle">租金收费规则</i-col>
        <i-col span="4">
            <i-input v-model="FEERULE_RENTNAME" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">起始清算日</i-col>
        <i-col span="4">
            <i-input v-model="QS_STARTMC" :readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">销售额标记</i-col>
        <i-col span="4">
            <i-input v-model="TAB_FLAGMC" :readonly="true"></i-input>
        </i-col>

        <i-col span="2" class="RowTitle">销项税率</i-col>
        <i-col span="4">
            <i-input v-model="XXSL" :readonly="true"></i-input>
        </i-col>
    </row>
    <row>
        <i-col span="2" class="RowTitle">租金滞纳规则</i-col>
        <i-col span="4">
            <i-input v-model="LATEFEERULENAME" readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">纸质编号</i-col>
        <i-col span="4">
            <i-input v-model="CONTRACTID_PAPER" readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">合同员</i-col>
        <i-col span="4">
            <i-input v-model="SIGNER_NAME" readonly="true"></i-input>
        </i-col>
        <i-col span="2" class="RowTitle">原合同号</i-col>
        <i-col span="4">
            <i-input v-model="CONTRACT_OLD" readonly="true"></i-input>
        </i-col>
    </row>

     <row>
        <i-col span="2" class="RowText">其他条款</i-col>
        <i-col span="22">
            <i-input v-model="DESCRIPTION" :readonly="true" type="textarea" :rows="5"></i-input>
        </i-col>
    </row>
    <row>
        <i-col span="12">
            <i-table size="small" :border="true"
                     :columns="colDefPP" :data="CONTRACT_BRAND"></i-table>
        </i-col>
        <i-col span="12">
            <i-table size="small" :border="true"
                     :columns="colDefSHOP" :data="CONTRACT_SHOP"></i-table>
        </i-col>
    </row>
    <row>
       <i-col span="24">
           <i-table height="200" size="small" :border="true"
                    :columns="colDefRENT" :data="CONTRACT_RENT"></i-table>
       </i-col>
    </row>
    <row>
       <i-col span="7">
           <i-table height="200" size="small" :border="true"
                    :columns="colGroup" :data="CONTRACT_GROUP"></i-table>
       </i-col>
        <i-col span="17">
            <i-table height="200" size="small" :border="true"
                     :columns="colDefJskl" :data="CONTJSKL"></i-table>
        </i-col>
    </row>

    <row>
        <i-col span="24">
            <i-table height="300" size="small" :border="true"
                     :columns="colDefRENTITEM" :data="CONTRACT_RENTITEM"></i-table>
        </i-col>
    </row>

    <row>
        <i-col span="24">
            <i-table height="200" size="small" :border="true"
                     :columns="colDefCOST" :data="CONTRACT_COST"></i-table>
        </i-col>
    </row>

    <row>
       <i-col span="24">
           <i-table height="200" size="small" :border="true"
                    :columns="colDefPAY" :data="CONTRACT_PAY"></i-table>
       </i-col>
    </row>
}

@section foot{
    <script type="text/javascript">
        var ve = new Vue({
            el: '#detail_Main',
            data: {
                Mainpanel: 'condition',
                disabled:true,
                CONTRACTID:"@contract.CONTRACTID",
                FDNAME:"@contract.FDNAME",
                STATUSMC:"@contract.STATUSMC",
                MERCHANTID:"@contract.MERCHANTID",
                MERNAME:"@contract.MERNAME",
                ORGNAME:"@contract.ORGNAME",
                CONT_START:"@contract.CONT_START",
                CONT_END:"@contract.CONT_END",

                FIT_BEGIN:"@contract.FIT_BEGIN",
                FIT_END:"@contract.FIT_END",

                FREE_BEGIN:"@contract.FREE_BEGIN",
                FREE_END:"@contract.FREE_END",

                OPERATERULENAME:"@contract.OPERATERULENAME",

                AREA_BUILD:"@contract.AREA_BUILD",
                AREAR:"@contract.AREAR",
                JXSL:"@contract.JXSL",
                FEERULE_RENTNAME:"@contract.FEERULE_RENTNAME",
                QS_STARTMC:"@contract.QS_STARTMC",
                TAB_FLAGMC:"@contract.TAB_FLAGMC",
                XXSL:"@contract.XXSL",
                LATEFEERULENAME:"@contract.LATEFEERULENAME",
                CONTRACTID_PAPER:"@contract.CONTRACTID_PAPER",
                SIGNER_NAME:"@contract.SIGNER_NAME",
                CONTRACT_OLD:"@contract.CONTRACT_OLD",
                DESCRIPTION:" ",

                FEERULE:[],

                colDefPP : [
                    {title: "品牌代码", key: 'BRANDID', width: 100},
                    { title: '品牌名称', key: 'NAME', width: 200 },
                ],
                CONTRACT_BRAND:[],
                colDefSHOP : [
                   {title: "商铺代码", key: 'CODE', width: 120},
                   { title: '业态代码', key: 'CATEGORYCODE', width: 100 },
                   { title: '业态名称', key: 'CATEGORYNAME', width: 120 },
                   { title: '建筑面积', key: 'AREA', width: 100 },
                   { title: '租用面积', key: 'AREA_RENTABLE', width: 100 }
                ],
                CONTRACT_SHOP:[],
                colDefRENT:[
                   { title: '时间段', key: 'INX', width: 80 },
                   {title: '开始日期',key: 'STARTDATE',width: 150},
                   {title: '结束日期',key: 'ENDDATE', width: 150},
                   {title: '金额类型', key: 'DJLX', width: 150,
                       render: function (h, params){
                           return h('Select', {
                               props: {
                                   value: params.row.DJLX
                               }
                           },
                               [h('Option', { props: { value: '1' } }, '日金额'),
                                h('Option', { props: { value: '2' } }, '月金额')
                               ])
                       }
                   },
                   {title: "单价", key: 'PRICE', width: 150},
                   {title: "租金", key: 'RENTS', width: 150 },
                 //  {title: "保底扣点", key: 'RENTS_JSKL', width: 120},
                   { title: "总租金", key: 'SUMRENTS', width: 150},
                ],
                CONTRACT_RENT:[],
                colGroup:[
                    { title: '扣点序号', key: 'GROUPNO', width: 100 },
                    {title: "基础扣点", key: 'JSKL', width: 120},
                    { title: "描述", key: 'DESCRIPTION', width: 100},
                ],
                CONTRACT_GROUP:[],
                colDefJskl:[
                   { title: '扣点序号', key: 'GROUPNO', width: 90 },
                   { title: '时间段', key: 'INX', width: 80 },
                   { title: '开始日期', key: 'STARTDATE', width: 150 },
                   { title: '结束日期', key: 'ENDDATE', width: 150},
                   { title: '起始金额', key: 'SALES_START',width:120},
                   { title: '结束金额(包含)', key: 'SALES_END',width:120},
                   { title: "扣点", key: 'JSKL', width: 80 },
                ],
                CONTJSKL:[],
                colDefRENTITEM:[
                    { title: '时间段', key: 'INX', width: 80 },
                    { title: '开始日期', key: 'STARTDATE', width: 150},
                    { title: '结束日期', key: 'ENDDATE', width: 150},
                    { title: '年月', key: 'YEARMONTH', width: 100},
                    { title: '租金', key: 'RENTS', width: 200},
                    { title: '生成日期',key: 'CREATEDATE',width: 150},
                    { title: '月清算标记', key: 'QSBJ', width: 100,
                        render: function (h, params){
                            return h('Select', {
                                props: {
                                    value: params.row.QSBJ
                                }
                            },
                                [
                                h('Option', { props: { value: "1" } }, '是'),
                                h('Option', { props: { value: "2" } }, '否')
                                ])
                        }
                    },
                    {title: '区间清算标记', key: 'QJQSBJ', width: 110,
                        render: function (h, params){
                            return h('Select', {
                                props: {
                                    value: params.row.QJQSBJ
                                }
                            },
                                [
                                h('Option', { props: { value: "1" } }, '是'),
                                h('Option', { props: { value: "2" } }, '否')
                                ])
                        }
                    }
                ],
                CONTRACT_RENTITEM:[],

                colDefCOST:[
                  { title: '序号', key: 'INX', width: 70 },
                  {title: "费用项目", key: 'TERMID', width: 100},
                  { title: "费用项目名称", key: 'NAME', width: 120 },
                  { title: '开始日期', key: 'STARTDATE',width: 150 },
                  {title: '结束日期',key: 'ENDDATE',width: 150 },
                  {title: '收费方式', key: 'SFFSMC', width: 150 },
                  { title: "单价", key: 'PRICE', width: 100},
                  {title: "金额", key: 'COST', width: 120 },
                  { title: "比例", key: 'KL', width: 100},
                  {title: '收费规则', key: 'FEERULENAME', width: 150},
                  {title: '滞纳规则', key: 'LATEFEERULENAME', width: 150},
                  {title: '生成日期是否和租金保持一致', key: 'IF_RENT_FEERULE', width: 150,
                  render: function (h, params) {
                      return h('Select',
                          {
                              props: {
                                  value: params.row.IF_RENT_FEERULE
                              }
                          },
                      [
                          h('Option', { props: { value: 1 } }, '是'),
                          h('Option', { props: { value: 2 } }, '否')
                      ]
                      )
                  }
                  }
                ],
                CONTRACT_COST:[],
                colDefPAY:[
                    { title: "收款方式名称", key: 'NAME', width: 120 },
                    { title: "费用项目名称", key: 'TERMNAME', width: 120 },
                    {title: '开始日期',key: 'STARTDATE',width: 150},
                    { title: '结束日期', key: 'ENDDATE',width: 150,},
                    {title: "比例", key: 'KL', width: 120},
                ],
                CONTRACT_PAY:[]

            },
            mounted:function(){
                var _self = this;
                _.Ajax('SearchContract', {
                    Data: { CONTRACTID: @contract.CONTRACTID }
                }, function (data) {
                    _self.DESCRIPTION=data.contract.DESCRIPTION;
                    _self.CONTRACT_BRAND = data.contractBrand;
                    _self.CONTRACT_SHOP = data.contractShop;

                    _self.CONTRACT_RENT = data.ContractParm.CONTRACT_RENT;;
                    _self.CONTRACT_GROUP = data.ContractParm.CONTRACT_GROUP;
                    _self.CONTJSKL = data.ContractParm.CONTJSKL;
                    _self.CONTRACT_RENTITEM = data.ContractRentParm.CONTRACT_RENTITEM;
                    _self.CONTRACT_COST = data.contractCost;
                    _self.CONTRACT_PAY = data.contractPay;
                });
            },
            methods: {
                exec: function (event) {
                    event.stopPropagation();
                    var _self = this;
                    _.Ajax('ExecData', {
                        Data: {CONTRACTID: @contract.CONTRACTID},
                    }, function (data) {
                        _self.$Message.info("审核成功");
                        setTimeout(function () {
                            window.location.reload();
                        }, 100);
                    });
                }
            }
        });
    </script>
}